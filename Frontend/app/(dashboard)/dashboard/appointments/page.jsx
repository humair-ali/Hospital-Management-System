'use client';import { useEffect, useState } from 'react';import { useUser } from '@/context/UserContext';import { getAppointments } from '@/lib/api';import { SPALink } from '@/components/SPALink';import { FaCalendarAlt, FaPlus, FaSearch, FaClock, FaCheckCircle, FaTimesCircle } from 'react-icons/fa';export default function DashboardAppointmentsPage() {  const { user, loading: authLoading } = useUser();  const [appointments, setAppointments] = useState([]);  const [loading, setLoading] = useState(true);  const [error, setError] = useState('');  const [search, setSearch] = useState('');  useEffect(() => {    if (user) {      fetchAppointments();    }  }, [user, search]);  async function fetchAppointments() {    try {      setLoading(true);      const response = await getAppointments({ limit: 100, search });      if (response.success && response.data) {        setAppointments(response.data);      } else {        setError('Failed to load appointments');      }    } catch (err) {      console.error('Error fetching appointments:', err);      setError(err.message || 'Error loading appointments');    } finally {      setLoading(false);    }  }  if (authLoading) return (    <div className="h-full flex items-center justify-center p-20">      <div className="animate-spin rounded-full h-12 w-12 border-4 border-primary-100 border-t-primary-600"></div>    </div>  );  return (    <div className="h-full flex flex-col gap-10 animate-in fade-in duration-700">      <div className="flex flex-col md:flex-row items-center justify-between gap-6 pb-6 border-b-2 border-gray-100">        <div className="flex items-center gap-4">          <div className="bg-primary-50 p-3 rounded-2xl text-primary-600 shadow-sm border border-primary-100">            <FaCalendarAlt size={24} />          </div>          <div>            <h1 className="text-3xl font-black text-gray-900 tracking-tight flex items-baseline gap-3">              Encounter Schedule <span className="text-[10px] font-black text-primary-600 bg-primary-50 px-3 py-1 rounded-full border border-primary-100 uppercase tracking-widest">Temporal Vector</span>            </h1>            <p className="text-sm text-gray-500 font-medium mt-1">Management of clinical appointment slots and practitioner availability</p>          </div>        </div>        <SPALink href="appointments/new">          <button className="btn-primary h-12 px-8 shadow-xl shadow-primary-500/20 flex items-center gap-2">            <FaPlus size={14} /> New Appointment          </button>        </SPALink>      </div>      {error && (        <div className="bg-red-50 text-red-600 border border-red-100 p-4 rounded-2xl text-sm font-bold">          {error}        </div>      )}      <div className="bg-white rounded-[2.5rem] border border-gray-100 shadow-2xl shadow-gray-200/50 overflow-hidden flex flex-col flex-1">        <div className="p-10 border-b border-gray-50 flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-50/30">          <div className="flex-1 w-full max-w-xl">            <div className="relative flex items-center group">              <FaSearch className="absolute left-6 text-gray-300 group-focus-within:text-primary-500 transition-colors" size={18} />              <input                type="text"                placeholder="Search by Patient, Doctor or Reason..."                className="w-full h-14 pl-14 pr-6 bg-white border border-gray-100 rounded-2xl outline-none text-sm font-black text-gray-700 placeholder:text-gray-300 shadow-sm focus:border-primary-200 transition-all"                value={search}                onChange={(e) => setSearch(e.target.value)}              />            </div>          </div>        </div>        <div className="flex-1 overflow-auto">          <table className="w-full border-collapse">            <thead>              <tr className="bg-gray-50/50">                <th className="py-8 pl-10 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Encounter ID</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Patient Identity</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Medical Practitioner</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Temporal Slot</th>                <th className="py-8 text-center text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Clinical State</th>                <th className="py-8 pr-10 text-right text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Observed Reason</th>              </tr>            </thead>            <tbody className="divide-y divide-gray-50">              {loading ? (                [1, 2, 3, 4, 5].map(i => (                  <tr key={i} className="animate-pulse">                    <td className="py-10 pl-10"><div className="w-20 h-8 bg-gray-100 rounded-xl"></div></td>                    <td className="py-10"><div className="w-32 h-5 bg-gray-100 rounded"></div></td>                    <td className="py-10"><div className="w-32 h-5 bg-gray-100 rounded"></div></td>                    <td className="py-10"><div className="w-40 h-10 bg-gray-100 rounded-2xl"></div></td>                    <td className="py-10 text-center"><div className="mx-auto w-24 h-8 bg-gray-100 rounded-xl"></div></td>                    <td className="py-10 pr-10 text-right"><div className="ml-auto w-32 h-5 bg-gray-100 rounded-xl"></div></td>                  </tr>                ))              ) : appointments.length === 0 ? (                <tr>                  <td colSpan={6} className="py-32 text-center text-gray-400 font-bold uppercase tracking-widest text-sm">                    No clinical encounters scheduled                  </td>                </tr>              ) : (                appointments.map((apt, idx) => (                  <tr key={apt.id} className="hover:bg-primary-50/30 transition-all group" style={{ animationDelay: `${idx * 50}ms` }}>                    <td className="py-10 pl-10">                      <span className="font-mono text-[10px] font-black text-primary-600 bg-primary-50 px-4 py-2 rounded-xl border border-primary-100 group-hover:bg-white transition-all uppercase tracking-widest">                        #APT-{apt.id.toString().padStart(4, '0')}                      </span>                    </td>                    <td className="py-10">                      <p className="font-black text-gray-900 text-sm leading-tight">{apt.patient_name}</p>                    </td>                    <td className="py-10">                      <p className="font-black text-gray-600 text-sm">Dr. {apt.doctor_name || 'Unassigned'}</p>                    </td>                    <td className="py-10">                      <div className="flex items-center gap-3 bg-gray-100 w-fit px-5 py-2.5 rounded-2xl border border-gray-200 group-hover:bg-white transition-colors">                        <FaClock size={12} className="text-primary-500" />                        <span className="text-[11px] font-black text-gray-900 uppercase">                          {new Date(apt.scheduled_at).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}                        </span>                      </div>                    </td>                    <td className="py-10 text-center">                      <span className={`px-5 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest border-2 shadow-sm transition-all ${apt.status === 'confirmed' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :                          apt.status === 'completed' ? 'bg-blue-50 text-blue-600 border-blue-100' :                            apt.status === 'cancelled' ? 'bg-rose-50 text-rose-600 border-rose-100' :                              'bg-amber-50 text-amber-600 border-amber-100'                        }`}>                        {apt.status}                      </span>                    </td>                    <td className="py-10 pr-10 text-right">                      <p className="text-[11px] font-bold text-gray-500 italic max-w-xs ml-auto line-clamp-1">                        {apt.reason || 'General clinical checkup'}                      </p>                    </td>                  </tr>                ))              )}            </tbody>          </table>        </div>      </div>    </div>  );}