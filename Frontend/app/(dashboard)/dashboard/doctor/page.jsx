'use client';import { useState, useEffect } from 'react';import { useUser } from '@/context/UserContext';import { getDoctorDashboardData, updateAppointmentStatus } from '@/lib/api';import {  FaUserInjured, FaCalendarCheck, FaClock, FaCheckCircle,  FaTimesCircle, FaChevronRight, FaRegCalendarAlt, FaHistory, FaArrowRight} from 'react-icons/fa';import { toast } from 'react-toastify';import { SPALink } from '@/components/SPALink';import { PageHeader } from '@/components/ui/PageHeader';import { StatCard } from '@/components/ui/StatCard';import { LoadingState } from '@/components/ui/LoadingState';import { EmptyState } from '@/components/ui/EmptyState';import { useNavigation } from '@/context/NavigationContext';export default function DoctorDashboard() {  const { user } = useUser();  const { navigateTo } = useNavigation();  const [data, setData] = useState(null);  const [loading, setLoading] = useState(true);  useEffect(() => {    fetchData();  }, []);  async function fetchData() {    try {      const res = await getDoctorDashboardData();      setData(res.data);    } catch (err) {      console.error('Core clinical data synchronization failure:', err);    } finally {      setLoading(false);    }  }  const handleStatusUpdate = async (id, status) => {    const originalData = { ...data };    const updatedAppointments = data.appointments.map((apt) =>      apt.id === id ? { ...apt, status: status } : apt    );    setData({ ...data, appointments: updatedAppointments });    try {      await updateAppointmentStatus(id, status);      toast.success(`Encounter Protocol: ${status.toUpperCase()}`);    } catch (err) {      toast.error('Strategic State Transition Failure');      setData(originalData);    }  };  const appointments = data?.appointments || [];  const pending = appointments.filter((a) => a.status === 'scheduled');  const actions = (    <div className="flex gap-4">      <SPALink href="patients" className="btn-secondary flex items-center gap-2 px-6">        <FaHistory size={14} /> Patient History      </SPALink>      <SPALink href="appointments" className="btn-primary flex items-center gap-2 px-6">        <FaRegCalendarAlt size={14} /> Schedule      </SPALink>    </div>  );  return (    <div className="h-full flex flex-col gap-10 animate-in fade-in duration-700">      <PageHeader        title={`Clinical Command: Dr. ${user?.name}`}        subtitle="Real-time patient telemetry and encounter synchronization"        actions={actions}      />      <div className="grid grid-cols-1 md:grid-cols-3 gap-8">        <StatCard          title="Scheduled Encounters"          value={appointments.length}          icon={FaRegCalendarAlt}          variant="primary"          description="Total visits for this cycle"          loading={loading}        />        <StatCard          title="Verified In-Queue"          value={pending.length}          icon={FaUserInjured}          variant="indigo"          description="Awaiting clinical intervention"          loading={loading}        />        <StatCard          title="Success Protocol"          value={appointments.filter(a => a.status === 'completed').length}          icon={FaCheckCircle}          variant="emerald"          description="Protocols finalized today"          loading={loading}        />      </div>      <div className="bg-white rounded-[2.5rem] border border-gray-100 shadow-2xl shadow-gray-200/50 overflow-hidden flex flex-col flex-1">        <div className="p-10 border-b border-gray-50 flex items-center justify-between bg-gray-50/30">          <div>            <h3 className="text-xl font-bold text-gray-900 tracking-tight flex items-center gap-4">              Encounter Queue <span className="text-[10px] font-bold text-primary-600 bg-primary-50 px-3 py-1 rounded-full border border-primary-100 uppercase tracking-wider">{pending.length} Waiting</span>            </h3>            <p className="text-xs font-medium text-gray-500 mt-1.5">Real-time scheduled patient telemetry</p>          </div>        </div>        <div className="flex-1 overflow-auto">          <table className="w-full border-collapse">            <thead>              <tr className="bg-gray-50/50">                <th className="py-8 pl-10 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Temporal Slot</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Patient Identity</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Reason for Visit</th>                <th className="py-8 pr-10 text-right text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Clinical Actions</th>              </tr>            </thead>            <tbody className="divide-y divide-gray-50">              {loading ? (                [1, 2, 3].map((_, i) => (                  <tr key={i} className="animate-pulse">                    <td className="py-8 pl-10"><div className="h-10 w-24 bg-gray-100 rounded-xl"></div></td>                    <td className="py-10"><div className="flex items-center gap-4"><div className="w-12 h-12 rounded-2xl bg-gray-100"></div><div className="space-y-2"><div className="w-24 h-4 bg-gray-100 rounded"></div><div className="w-16 h-2 bg-gray-50 rounded"></div></div></div></td>                    <td className="py-10"><div className="w-32 h-6 bg-gray-100 rounded-full"></div></td>                    <td className="py-10 pr-10 text-right"><div className="flex justify-end gap-3"><div className="w-11 h-11 bg-gray-100 rounded-xl"></div><div className="w-11 h-11 bg-gray-100 rounded-xl"></div><div className="w-32 h-11 bg-gray-100 rounded-xl"></div></div></td>                  </tr>                ))              ) : pending.length === 0 ? (                <tr>                  <td colSpan={4} className="py-20 text-center">                    <EmptyState title="Queue Empty" subtitle="No patient encounters currently synchronized for scheduling." />                  </td>                </tr>              ) : (                pending.map((apt) => (                  <tr key={apt.id} className="hover:bg-primary-50/30 transition-all group">                    <td className="py-8 pl-10">                      <div className="flex items-center gap-3 bg-gray-100 w-fit px-4 py-2 rounded-xl border border-gray-200 shadow-sm group-hover:bg-white transition-colors">                        <FaClock size={12} className="text-primary-500" />                        <span className="text-sm font-bold text-gray-900 leading-none">{apt.scheduled_at ? new Date(apt.scheduled_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '--:--'}</span>                      </div>                    </td>                    <td className="py-10">                      <div className="flex items-center gap-4">                        <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-primary-100 to-primary-200 flex items-center justify-center text-primary-700 font-bold text-lg shadow-sm group-hover:scale-110 transition-transform">                          {apt.patient_name?.charAt(0) || 'P'}                        </div>                        <div>                          <p className="font-bold text-gray-900 leading-tight">{apt.patient_name}</p>                          <p className="text-[10px] font-bold text-gray-500 uppercase tracking-wider mt-1">ID: #{apt.id.toString().padStart(4, '0')}</p>                        </div>                      </div>                    </td>                    <td className="py-10">                      <span className="text-[10px] font-bold uppercase tracking-wider bg-gray-100 text-gray-600 px-3 py-1 rounded-full border border-gray-200">                        {apt.reason || 'General Checkup'}                      </span>                    </td>                    <td className="py-10 pr-10 text-right">                      <div className="flex justify-end gap-3 opacity-90 group-hover:opacity-100 transition-all">                        <button                          onClick={() => handleStatusUpdate(apt.id, 'completed')}                          className="w-11 h-11 flex items-center justify-center text-emerald-600 bg-emerald-50 hover:bg-emerald-600 hover:text-white rounded-xl transition-all shadow-sm border border-emerald-100"                          title="Complete Visit"                        >                          <FaCheckCircle size={14} />                        </button>                        <button                          onClick={() => handleStatusUpdate(apt.id, 'cancelled')}                          className="w-11 h-11 flex items-center justify-center text-rose-600 bg-rose-50 hover:bg-rose-600 hover:text-white rounded-xl transition-all shadow-sm border border-rose-100"                          title="Cancel Visit"                        >                          <FaTimesCircle size={14} />                        </button>                        <button                          onClick={() => navigateTo(`medical-records/new?patient_id=${apt.patient_id}`)}                          className="btn-primary h-11 px-6 ml-4 text-xs flex items-center gap-3 active:scale-95 transition-all"                        >                          Start Visit <FaArrowRight size={10} />                        </button>                      </div>                    </td>                  </tr>                ))              )}            </tbody>          </table>        </div>      </div>    </div>  );}