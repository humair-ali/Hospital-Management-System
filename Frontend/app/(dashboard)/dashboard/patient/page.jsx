'use client';import { useUser, hasRole } from '@/context/UserContext';import { SPALink } from '@/components/SPALink';import { useState, useEffect } from 'react';import { getAppointments } from '@/lib/api';import {  FaCalendarPlus, FaCalendarCheck,  FaCalendarAlt, FaClipboardList, FaFileMedicalAlt, FaCheckCircle, FaBriefcaseMedical} from 'react-icons/fa';import { PageHeader } from '@/components/ui/PageHeader';import { StatCard } from '@/components/ui/StatCard';import { LoadingState } from '@/components/ui/LoadingState';import { EmptyState } from '@/components/ui/EmptyState';export default function PatientDashboard() {  const { user, loading } = useUser();  const [appointments, setAppointments] = useState([]);  const [dataLoading, setDataLoading] = useState(true);  useEffect(() => {    if (user && hasRole(user.role, ['patient'])) {      fetchData();    }  }, [user]);  async function fetchData() {    try {      const patientId = user?.patient_id;      if (!patientId) return;      const appts = await getAppointments({ patient_id: patientId, limit: 10 });      setAppointments(appts.data || []);    } catch (err) {      console.error('Wellness data synchronization failure:', err);    } finally {      setDataLoading(false);    }  }  const getGreeting = () => {    const hour = new Date().getHours();    if (hour < 12) return 'Wellness Morning';    if (hour < 17) return 'Guided Afternoon';    return 'Peaceful Evening';  };  const today = new Date();  const dateString = today.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });  if (!user || !hasRole(user.role, ['patient'])) {    return (      <EmptyState        title="Unauthorized Access"        subtitle="Please authenticate to access your patient portal"        actions={          <SPALink href="/" className="btn-primary">            Authenticate Identity          </SPALink>        }      />    );  }  const actions = (    <div className="flex gap-4">      <SPALink href="appointments/new" className="btn-primary flex items-center gap-2 px-6">        <FaCalendarPlus size={14} /> Book Appointment      </SPALink>      <div className="h-12 px-6 bg-white border border-gray-100 rounded-xl text-gray-600 flex items-center gap-3 shadow-sm">        <FaCalendarAlt className="text-primary-500" />        <span className="text-[10px] font-black uppercase tracking-widest">{dateString}</span>      </div>    </div>  );  return (    <div className="h-full flex flex-col gap-10 animate-in fade-in duration-700">      <PageHeader        title={`${getGreeting()}, ${user.name}`}        subtitle="Comprehensive clinical telemetry and encounter history"        actions={actions}      />      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">        <StatCard          title="Active Appointments"          value={appointments.filter(a => a.status === 'confirmed' || a.status === 'requested').length}          icon={FaCalendarCheck}          variant="primary"          description="Active tracking protocol"          loading={dataLoading}        />        <StatCard          title="Medical Checks"          value={appointments.filter(a => a.status === 'completed').length}          icon={FaFileMedicalAlt}          variant="indigo"          description="Historical clinical records"          loading={dataLoading}        />        <div className="bg-gradient-to-br from-violet-600 to-indigo-700 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl md:col-span-2 lg:col-span-1">          <div className="relative z-10">            <p className="text-[10px] font-black text-violet-200 uppercase tracking-[0.2em] mb-2">Health Passport</p>            <h3 className="text-xl font-black tracking-tight uppercase">Institutional Node</h3>            <p className="text-[10px] font-bold text-white/60 mt-4 leading-relaxed uppercase tracking-widest">Access clinical history and real-time encounter telemetry from any verified node.</p>          </div>          <div className="absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>        </div>      </div>      <div className="grid grid-cols-1 gap-10">        <div className="bg-white rounded-[2.5rem] border border-gray-100 shadow-2xl shadow-gray-200/50 overflow-hidden flex flex-col">          <div className="p-10 border-b border-gray-50 flex items-center justify-between bg-gray-50/30">            <div>              <h3 className="text-2xl font-black text-gray-900 tracking-tight flex items-center gap-4">                Clinical Registry <span className="text-[10px] font-black text-primary-600 bg-primary-50 px-4 py-1.5 rounded-full border border-primary-100 uppercase tracking-widest">ENCOUNTERS</span>              </h3>              <p className="text-xs font-medium text-gray-500 mt-1.5">Your upcoming and past medical appointments</p>            </div>          </div>          <div className="overflow-x-auto">            <table className="w-full">              <thead>                <tr className="bg-gray-50/50">                  <th className="py-6 pl-10 text-left text-[10px] font-black text-gray-400 uppercase tracking-widest">Temporal Slot</th>                  <th className="py-6 text-left text-[10px] font-black text-gray-400 uppercase tracking-widest">Practitioner</th>                  <th className="py-6 text-left text-[10px] font-black text-gray-400 uppercase tracking-widest">Reason</th>                  <th className="py-6 pr-10 text-right text-[10px] font-black text-gray-400 uppercase tracking-widest">Status</th>                </tr>              </thead>              <tbody className="divide-y divide-gray-50">                {dataLoading ? (                  [1, 2, 3].map((_, i) => (                    <tr key={i} className="animate-pulse">                      <td className="py-8 pl-10"><div className="space-y-2"><div className="w-24 h-4 bg-gray-100 rounded"></div><div className="w-16 h-2 bg-gray-50 rounded"></div></div></td>                      <td className="py-8"><div className="flex items-center gap-3"><div className="w-8 h-8 rounded-lg bg-gray-100"></div><div className="w-24 h-4 bg-gray-100 rounded"></div></div></td>                      <td className="py-8"><div className="w-32 h-4 bg-gray-100 rounded"></div></td>                      <td className="py-8 pr-10 text-right"><div className="ml-auto w-20 h-6 bg-gray-100 rounded-lg"></div></td>                    </tr>                  ))                ) : appointments.length === 0 ? (                  <tr>                    <td colSpan={4} className="py-20 text-center">                      <p className="text-gray-400 font-medium italic">No clinical encounters scheduled</p>                    </td>                  </tr>                ) : (                  appointments.map((apt) => (                    <tr key={apt.id} className="hover:bg-gray-50/50 transition-colors">                      <td className="py-8 pl-10">                        <div className="flex flex-col">                          <span className="font-black text-gray-900 text-sm tracking-tight">{new Date(apt.scheduled_at).toLocaleDateString()}</span>                          <span className="text-[10px] font-bold text-primary-600 uppercase mt-1">{new Date(apt.scheduled_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>                        </div>                      </td>                      <td className="py-8">                        <div className="flex items-center gap-3">                          <div className="w-8 h-8 rounded-lg bg-indigo-50 text-indigo-600 flex items-center justify-center font-bold text-xs">                            {apt.doctor_name?.charAt(0) || 'D'}                          </div>                          <span className="font-bold text-gray-700 text-sm">Dr. {apt.doctor_name}</span>                        </div>                      </td>                      <td className="py-8">                        <p className="text-sm font-medium text-gray-500 line-clamp-1">{apt.reason || 'Routine Checkup'}</p>                      </td>                      <td className="py-8 pr-10 text-right">                        <span className={`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest border ${apt.status === 'confirmed' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :                          apt.status === 'requested' ? 'bg-amber-50 text-amber-600 border-amber-100' :                            'bg-gray-50 text-gray-500 border-gray-100'                          }`}>                          {apt.status}                        </span>                      </td>                    </tr>                  ))                )}              </tbody>            </table>          </div>        </div>      </div>    </div>  );}