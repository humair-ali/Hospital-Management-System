'use client';import { useEffect, useState } from 'react';import { useUser } from '@/context/UserContext';import { getBills } from '@/lib/api';import { SPALink } from '@/components/SPALink';import { FaMoneyBillWave, FaPlus, FaSearch, FaFileInvoiceDollar, FaCheckCircle, FaExclamationCircle } from 'react-icons/fa';export default function DashboardBillingPage() {  const { user, loading: authLoading } = useUser();  const [bills, setBills] = useState([]);  const [loading, setLoading] = useState(true);  const [error, setError] = useState('');  const [search, setSearch] = useState('');  useEffect(() => {    if (user) {      fetchBills();    }  }, [user, search]);  async function fetchBills() {    try {      setLoading(true);      const response = await getBills({ limit: 100, search });      if (response.success && response.data) {        setBills(response.data);      } else {        setError('Failed to load bills');      }    } catch (err) {      console.error('Error fetching bills:', err);      setError(err.message || 'Error loading bills');    } finally {      setLoading(false);    }  }  if (authLoading) return (    <div className="h-full flex items-center justify-center p-20">      <div className="animate-spin rounded-full h-12 w-12 border-4 border-primary-100 border-t-primary-600"></div>    </div>  );  const totalAmount = bills.reduce((sum, bill) => sum + (parseFloat(bill.total_amount) || 0), 0);  const paidAmount = bills.filter(b => b.status === 'paid').reduce((sum, b) => sum + (parseFloat(b.total_amount) || 0), 0);  const pendingAmount = totalAmount - paidAmount;  return (    <div className="h-full flex flex-col gap-10 animate-in fade-in duration-700">      <div className="flex flex-col md:flex-row items-center justify-between gap-6 pb-6 border-b-2 border-gray-100">        <div className="flex items-center gap-4">          <div className="bg-emerald-50 p-3 rounded-2xl text-emerald-600 shadow-sm border border-emerald-100">            <FaMoneyBillWave size={24} />          </div>          <div>            <h1 className="text-3xl font-black text-gray-900 tracking-tight flex items-baseline gap-3">              Fiscal Ledger <span className="text-[10px] font-black text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full border border-emerald-100 uppercase tracking-widest">Revenue Sync</span>            </h1>            <p className="text-sm text-gray-500 font-medium mt-1">Management of hospital revenue streams and itemized billing protocols</p>          </div>        </div>        <SPALink href="billing/new">          <button className="btn-primary h-12 px-8 shadow-xl shadow-primary-500/20 flex items-center gap-2">            <FaPlus size={14} /> New Invoice          </button>        </SPALink>      </div>      <div className="grid grid-cols-1 md:grid-cols-3 gap-8">        <div className="bg-gradient-to-br from-gray-900 to-black p-8 rounded-[2.5rem] shadow-xl text-white relative overflow-hidden group">          <div className="absolute top-0 right-0 w-32 h-32 bg-white rounded-full opacity-5 -translate-y-1/2 translate-x-1/2"></div>          <p className="text-xs font-bold uppercase tracking-widest mb-2 opacity-60 text-white">Gross Revenue</p>          <h3 className="text-4xl font-black tracking-tight text-white mb-8">Rs. {totalAmount.toLocaleString()}</h3>          <div className="pt-4 border-t border-white/10 flex items-center justify-between">            <span className="text-[10px] font-black uppercase tracking-widest opacity-60 text-white">Verified Total</span>            <FaFileInvoiceDollar size={14} className="opacity-20 text-white" />          </div>        </div>        <div className="bg-gradient-to-br from-emerald-600 to-emerald-800 p-8 rounded-[2.5rem] shadow-xl text-white relative overflow-hidden group">          <div className="absolute top-0 right-0 w-32 h-32 bg-white rounded-full opacity-10 -translate-y-1/2 translate-x-1/2"></div>          <p className="text-xs font-bold uppercase tracking-widest mb-2 opacity-80 text-white">Collected</p>          <h3 className="text-4xl font-black tracking-tight text-white mb-8">Rs. {paidAmount.toLocaleString()}</h3>          <div className="pt-4 border-t border-white/20 flex items-center justify-between">            <span className="text-[10px] font-black uppercase tracking-widest opacity-80 text-white">Live Liquidity</span>            <FaCheckCircle size={14} className="opacity-50 text-white" />          </div>        </div>        <div className="bg-gradient-to-br from-rose-600 to-rose-800 p-8 rounded-[2.5rem] shadow-xl text-white relative overflow-hidden group">          <div className="absolute top-0 right-0 w-32 h-32 bg-white rounded-full opacity-10 -translate-y-1/2 translate-x-1/2"></div>          <p className="text-xs font-bold uppercase tracking-widest mb-2 opacity-80 text-white">Outstanding</p>          <h3 className="text-4xl font-black tracking-tight text-white mb-8">Rs. {pendingAmount.toLocaleString()}</h3>          <div className="pt-4 border-t border-white/20 flex items-center justify-between">            <span className="text-[10px] font-black uppercase tracking-widest opacity-80 text-white">Receivables Portfolio</span>            <FaExclamationCircle size={14} className="opacity-50 text-white" />          </div>        </div>      </div>      <div className="bg-white rounded-[2.5rem] border border-gray-100 shadow-2xl shadow-gray-200/50 overflow-hidden flex flex-col flex-1">        <div className="p-10 border-b border-gray-50 flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-50/30">          <div className="flex-1 w-full max-w-xl">            <div className="relative flex items-center group">              <FaSearch className="absolute left-6 text-gray-300 group-focus-within:text-primary-500 transition-colors" size={18} />              <input                type="text"                placeholder="Search by Patient Name or MRN..."                className="w-full h-14 pl-14 pr-6 bg-white border border-gray-100 rounded-2xl outline-none text-sm font-black text-gray-700 placeholder:text-gray-300 shadow-sm focus:border-primary-200 transition-all"                value={search}                onChange={(e) => setSearch(e.target.value)}              />            </div>          </div>        </div>        <div className="flex-1 overflow-auto">          <table className="w-full border-collapse">            <thead>              <tr className="bg-gray-50/50">                <th className="py-8 pl-10 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Matrix ID</th>                <th className="py-8 text-left text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Patient Principal</th>                <th className="py-8 text-right text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Fiscal Total</th>                <th className="py-8 text-center text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Current State</th>                <th className="py-8 pr-10 text-right text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Creation Vector</th>              </tr>            </thead>            <tbody className="divide-y divide-gray-50">              {loading ? (                [1, 2, 3, 4, 5].map(i => (                  <tr key={i} className="animate-pulse">                    <td className="py-10 pl-10"><div className="w-20 h-8 bg-gray-100 rounded-xl"></div></td>                    <td className="py-10"><div className="w-40 h-5 bg-gray-100 rounded"></div></td>                    <td className="py-10 text-right"><div className="ml-auto w-24 h-6 bg-gray-100 rounded"></div></td>                    <td className="py-10 text-center"><div className="mx-auto w-24 h-8 bg-gray-100 rounded-xl"></div></td>                    <td className="py-10 pr-10 text-right"><div className="ml-auto w-32 h-5 bg-gray-100 rounded-xl"></div></td>                  </tr>                ))              ) : bills.length === 0 ? (                <tr>                  <td colSpan={5} className="py-32 text-center text-gray-400 font-bold uppercase tracking-widest text-sm">                    No fiscal transactions found                  </td>                </tr>              ) : (                bills.map((bill, idx) => (                  <tr key={bill.id} className="hover:bg-primary-50/30 transition-all group" style={{ animationDelay: `${idx * 50}ms` }}>                    <td className="py-10 pl-10">                      <span className="font-mono text-[10px] font-black text-emerald-600 bg-emerald-50 px-4 py-2 rounded-xl border border-emerald-100 group-hover:bg-white transition-all uppercase tracking-widest shadow-sm">                        #INV-{bill.id.toString().padStart(5, '0')}                      </span>                    </td>                    <td className="py-10">                      <div>                        <p className="font-black text-gray-900 text-sm leading-tight">{bill.patient_name}</p>                        {bill.patient_id && <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest mt-1.5">MRN: #{bill.patient_id.toString().padStart(6, '0')}</p>}                      </div>                    </td>                    <td className="py-10 text-right">                      <div className="flex flex-col items-end">                        <p className="font-black text-gray-900 text-lg leading-none tracking-tighter">Rs.{(parseFloat(bill.total_amount) || 0).toLocaleString()}</p>                        <p className="text-[9px] font-extrabold text-emerald-500 uppercase mt-1.5 tracking-widest">Gross total</p>                      </div>                    </td>                    <td className="py-10 text-center">                      <span className={`px-5 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest border-2 shadow-sm transition-all ${bill.status === 'paid' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :                          bill.status === 'overdue' ? 'bg-rose-50 text-rose-600 border-rose-100' :                            'bg-amber-50 text-amber-600 border-amber-100'                        }`}>                        {bill.status}                      </span>                    </td>                    <td className="py-10 pr-10 text-right">                      <p className="text-[11px] font-black text-gray-400 uppercase tracking-tighter">                        {new Date(bill.created_at).toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}                      </p>                    </td>                  </tr>                ))              )}            </tbody>          </table>        </div>      </div>    </div>  );}