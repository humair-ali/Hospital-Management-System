'use client';import { useUser, hasRole } from '@/context/UserContext';import { SPALink } from '@/components/SPALink';import { useState, useEffect } from 'react';import { getAppointments } from '@/lib/api';import {  FaConciergeBell, FaCalendarPlus, FaCalendarAlt,  FaSearch, FaUsers, FaCheckCircle, FaUserPlus,  FaClock, FaUserMd, FaArrowRight, FaChevronRight} from 'react-icons/fa';import { PageHeader } from '@/components/ui/PageHeader';import { StatCard } from '@/components/ui/StatCard';import { LoadingState } from '@/components/ui/LoadingState';import { EmptyState } from '@/components/ui/EmptyState';export default function ReceptionistDashboard() {  const { user, loading } = useUser();  const [appointments, setAppointments] = useState([]);  const [dataLoading, setDataLoading] = useState(true);  useEffect(() => {    if (user && hasRole(user.role, ['receptionist', 'admin'])) {      fetchData();    }  }, [user]);  async function fetchData() {    try {      const appts = await getAppointments({ limit: 50 });      setAppointments(appts.data || []);    } catch (err) {      console.error('Core registry sync failure:', err);    } finally {      setDataLoading(false);    }  }  const today = new Date();  const dateString = today.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });  const isAuthorized = user && hasRole(user.role, ['receptionist', 'admin']);  if (!isAuthorized) {    return (      <EmptyState        title="Unauthorized Node"        subtitle="Receptionist privileges required for this dashboard"        actions={          <SPALink href="/" className="btn-primary">            Return to Security Protocol          </SPALink>        }      />    );  }  const actions = (    <div className="flex gap-4">      <SPALink href="patients/new" className="btn-primary flex items-center gap-2 px-6">        <FaUserPlus size={14} /> Register Patient      </SPALink>      <SPALink href="appointments/new" className="btn-secondary flex items-center gap-2 px-6">        <FaCalendarPlus size={14} /> Next Appointment      </SPALink>      <div className="h-14 px-8 bg-gray-900 rounded-2xl text-white flex items-center gap-4 shadow-2xl border border-gray-800">        <FaClock className="text-primary-400" />        <span className="text-xs font-bold uppercase tracking-wider leading-none mt-0.5">{dateString}</span>      </div>    </div>  );  return (    <div className="h-full flex flex-col gap-10 animate-in fade-in duration-700">      <PageHeader        title="Front Desk Control"        subtitle="Manage patient intake and appointment synchronization"        actions={actions}      />      <div className="grid grid-cols-1 md:grid-cols-3 gap-8">        <StatCard          title="Daily Triage"          value={appointments.length}          icon={FaConciergeBell}          description="Total visits today"          variant="primary"          loading={dataLoading}        />        <StatCard          title="Active Queue"          value={appointments.filter(a => a.status === 'confirmed').length}          icon={FaUsers}          description="Real-time queue monitoring"          variant="indigo"          loading={dataLoading}        />        <StatCard          title="Completed"          value={appointments.filter(a => a.status === 'completed').length}          icon={FaCheckCircle}          description="Optimized flow active"          variant="success"          loading={dataLoading}        />      </div>      <div className="bg-white rounded-[2.5rem] border border-gray-100 shadow-2xl shadow-gray-200/50 overflow-hidden flex flex-col">        <div className="p-10 border-b border-gray-50 flex flex-col md:flex-row items-center justify-between gap-6 bg-gray-50/30">          <div>            <h3 className="text-xl font-bold text-gray-900 tracking-tight flex items-center gap-4">              Patient Registry <span className="text-[10px] font-bold text-primary-600 bg-primary-50 px-3 py-1 rounded-full border border-primary-100 uppercase tracking-widest">LIVE VECTOR</span>            </h3>            <p className="text-xs font-medium text-gray-500 mt-1.5">Verified identity vector & triage status</p>          </div>          <div className="max-w-md w-full group">            <div className="input-with-icon-wrapper">              <div className="input-icon-container">                <FaSearch className="text-gray-400 group-focus-within:text-primary-500 transition-colors" />              </div>              <input                type="text"                placeholder="Search registry by Name, ID, or MRN..."                className="input-field input-field-with-icon !h-14 bg-white rounded-2xl shadow-sm"              />            </div>          </div>        </div>        <div className="flex-1 overflow-auto">          <table className="w-full border-collapse">            <thead>              <tr className="bg-gray-50/50">                <th className="py-6 pl-10 text-left text-[10px] font-bold text-gray-400 uppercase tracking-wider">Patient identity</th>                <th className="py-6 text-left text-[10px] font-bold text-gray-400 uppercase tracking-wider">Assigned practitioner</th>                <th className="py-6 text-left text-[10px] font-bold text-gray-400 uppercase tracking-wider">Temporal slot</th>                <th className="py-6 pr-10 text-right text-[10px] font-bold text-gray-400 uppercase tracking-wider">Status</th>              </tr>            </thead>            <tbody className="divide-y divide-gray-50">              {dataLoading ? (                [1, 2, 3, 4, 5].map((_, i) => (                  <tr key={i} className="animate-pulse">                    <td className="py-10 pl-10"><div className="flex items-center gap-4"><div className="w-12 h-12 rounded-2xl bg-gray-50 border border-gray-100"></div><div className="space-y-2"><div className="w-32 h-4 bg-gray-100 rounded"></div><div className="w-20 h-2 bg-gray-50 rounded"></div></div></div></td>                    <td className="py-10"><div className="flex items-center gap-3"><div className="w-10 h-10 rounded-xl bg-gray-50"></div><div className="w-28 h-4 bg-gray-100 rounded"></div></div></td>                    <td className="py-10"><div className="space-y-2"><div className="w-16 h-4 bg-gray-100 rounded"></div><div className="w-24 h-2 bg-gray-50 rounded"></div></div></td>                    <td className="py-10 pr-10 text-right"><div className="flex items-center justify-end gap-6"><div className="w-20 h-6 bg-gray-100 rounded-lg"></div><div className="w-4 h-4 bg-gray-100 rounded"></div></div></td>                  </tr>                ))              ) : appointments.length === 0 ? (                <tr>                  <td colSpan={4} className="py-20 text-center">                    <EmptyState title="Registry Empty" subtitle="No patient encounters recorded for this cycle." />                  </td>                </tr>              ) : (                appointments.map((apt, idx) => (                  <tr key={apt.id} className="hover:bg-primary-50/30 transition-all group cursor-pointer" style={{ animationDelay: `${idx * 50}ms` }}>                    <td className="py-10 pl-10">                      <div className="flex items-center gap-4">                        <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-white to-gray-50 border border-gray-100 shadow-sm flex items-center justify-center text-primary-600 font-bold text-lg group-hover:scale-110 group-hover:bg-white transition-all">                          {apt.patient_name?.charAt(0) || 'P'}                        </div>                        <div>                          <p className="font-bold text-gray-900 leading-tight">{apt.patient_name}</p>                          <p className="text-[10px] font-bold text-gray-500 uppercase tracking-wider mt-1">ID: #REG-{apt.id.toString().padStart(4, '0')}</p>                        </div>                      </div>                    </td>                    <td className="py-10">                      <div className="flex items-center gap-3">                        <div className="w-10 h-10 rounded-xl bg-indigo-50 text-indigo-500 flex items-center justify-center">                          <FaUserMd />                        </div>                        <span className="font-bold text-gray-700 text-sm">Dr. {apt.doctor_name || 'Protocol-Pending'}</span>                      </div>                    </td>                    <td className="py-10">                      <div className="flex flex-col">                        <span className="font-bold text-gray-900 text-sm tracking-tight">{new Date(apt.scheduled_at).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })}</span>                        <div className="flex items-center gap-2 text-gray-500 mt-1.5 border-t border-gray-50 pt-1.5">                          <FaClock size={10} />                          <span className="text-[10px] font-bold uppercase tracking-wider">{new Date(apt.scheduled_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>                        </div>                      </div>                    </td>                    <td className="py-10 pr-10 text-right">                      <div className="flex items-center justify-end gap-6">                        <span className={`px-4 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider border-2 shadow-sm transition-all ${apt.status === 'confirmed' ? 'bg-primary-50 text-primary-600 border-primary-100' :                          apt.status === 'completed' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :                            apt.status === 'cancelled' ? 'bg-red-50 text-red-600 border-red-100' :                              'bg-amber-50 text-amber-600 border-amber-100'                          }`}>                          {apt.status}                        </span>                        <FaChevronRight size={12} className="text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1 transition-all" />                      </div>                    </td>                  </tr>                ))              )}            </tbody>          </table>        </div>      </div>    </div>  );}