'use client';import { useState, useEffect } from 'react';import { useParams } from 'next/navigation';import { useNavigation } from '@/context/NavigationContext';import { getBill } from '@/lib/api';import { FaFileInvoiceDollar, FaPrint, FaArrowLeft, FaCheckCircle, FaExclamationCircle, FaUser, FaCalendarDay } from 'react-icons/fa';import { toast } from 'react-toastify';import { LoadingState } from '@/components/ui/LoadingState';export default function BillDetailPage() {    const { id } = useParams();    const { navigateTo } = useNavigation();    const [bill, setBill] = useState(null);    const [loading, setLoading] = useState(true);    useEffect(() => {        if (id) fetchBill();    }, [id]);    async function fetchBill() {        try {            const res = await getBill(id);            if (res.success) {                setBill(res.data);            } else {                toast.error('Bill not found');            }        } catch (err) {            toast.error('Failed to retrieve fiscal record');            navigateTo('billing');        } finally {            setLoading(false);        }    }    if (loading) return <LoadingState message="Decoding Fiscal Matrix..." />;    if (!bill) return (        <div className="flex flex-col items-center justify-center p-20 gap-6">            <FaExclamationCircle className="text-rose-500" size={48} />            <p className="text-xl font-black text-gray-900 uppercase tracking-widest">Fiscal Record Missing</p>            <button onClick={() => navigateTo('billing')} className="btn-secondary px-8">Return to Ledger</button>        </div>    );    const isPaid = bill.status === 'paid';    return (        <div className="max-w-5xl mx-auto space-y-10 animate-in fade-in duration-700 pb-20">            <div className="flex justify-between items-center px-4 md:px-0">                <button                    onClick={() => navigateTo('billing')}                    className="flex items-center gap-3 text-sm font-black text-gray-400 hover:text-primary-600 transition-colors uppercase tracking-[0.2em]"                >                    <FaArrowLeft size={12} /> Return to Ledger                </button>                <button                    onClick={() => window.print()}                    className="btn-primary h-12 px-8 flex items-center gap-3 shadow-xl shadow-primary-500/10"                >                    <FaPrint size={14} /> Print Official Invoice                </button>            </div>            <div className="bg-white rounded-[3rem] shadow-2xl border border-gray-100 overflow-hidden print:shadow-none print:border-none">                <div className={`h-4 ${isPaid ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>                <div className="p-8 md:p-16 space-y-16">                    <div className="flex flex-col md:flex-row justify-between items-start gap-10">                        <div className="space-y-4">                            <div className="flex items-center gap-4">                                <div className="w-14 h-14 bg-gray-900 rounded-2xl flex items-center justify-center text-white shadow-2xl">                                    <FaFileInvoiceDollar size={24} />                                </div>                                <div>                                    <h1 className="text-4xl font-black text-gray-900 tracking-tighter uppercase leading-none">Invoice</h1>                                    <p className="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em] mt-2">OFFICIAL FISCAL RECORD</p>                                </div>                            </div>                            <div className="pt-4">                                <span className="font-mono text-xl font-black text-gray-300">#INV-{bill.id.toString().padStart(5, '0')}</span>                            </div>                        </div>                        <div className="text-right space-y-4">                            <div className={`inline-flex items-center gap-3 px-6 py-2 rounded-2xl border-2 font-black text-xs uppercase tracking-widest ${isPaid ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : 'bg-rose-50 text-rose-600 border-rose-100'                                }`}>                                {isPaid ? <FaCheckCircle size={14} /> : <FaExclamationCircle size={14} />} {bill.status}                            </div>                            <div className="space-y-1">                                <p className="text-[11px] font-black text-gray-400 uppercase tracking-widest">Temporal Vector</p>                                <p className="text-sm font-black text-gray-900">{new Date(bill.created_at).toLocaleDateString(undefined, { dateStyle: 'long' })}</p>                            </div>                        </div>                    </div>                    <div className="h-px bg-gray-50"></div>                    <div className="grid grid-cols-1 md:grid-cols-2 gap-20">                        <div className="space-y-6">                            <h4 className="text-[11px] font-black text-gray-400 uppercase tracking-[0.3em] flex items-center gap-3 text-primary-600">                                <FaUser size={10} /> Patient Principal                            </h4>                            <div className="space-y-2">                                <p className="text-2xl font-black text-gray-900 tracking-tight">{bill.patient_name}</p>                                <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest leading-relaxed">Identity Vector Sync Complete</p>                            </div>                        </div>                        <div className="space-y-6">                            <h4 className="text-[11px] font-black text-gray-400 uppercase tracking-[0.3em] flex items-center gap-3 text-indigo-600">                                <FaCalendarDay size={10} /> Fiscal Strategy                            </h4>                            <div className="space-y-2">                                <p className="text-sm font-black text-gray-700">Immediate Settlement</p>                                <p className="text-[10px] font-black text-gray-400 uppercase tracking-widest leading-relaxed">Verified by Institutional Comptroller</p>                            </div>                        </div>                    </div>                    <div className="space-y-6">                        <h4 className="text-[11px] font-black text-gray-400 uppercase tracking-[0.3em]">Itemized Billing Protocols</h4>                        <div className="rounded-3xl border border-gray-100 overflow-hidden shadow-sm">                            <table className="w-full text-left">                                <thead className="bg-gray-50/50">                                    <tr>                                        <th className="px-8 py-6 text-[10px] font-black text-gray-400 uppercase tracking-widest">Service Description</th>                                        <th className="px-8 py-6 text-[10px] font-black text-gray-400 uppercase tracking-widest text-center">Qty</th>                                        <th className="px-8 py-6 text-[10px] font-black text-gray-400 uppercase tracking-widest text-right">Unit Price</th>                                        <th className="px-8 py-6 text-[10px] font-black text-gray-400 uppercase tracking-widest text-right">Ext. Total</th>                                    </tr>                                </thead>                                <tbody className="divide-y divide-gray-50">                                    {(bill.items || []).length > 0 ? (bill.items.map((item, idx) => (                                        <tr key={idx} className="hover:bg-gray-50/30 transition-colors">                                            <td className="px-8 py-6 font-bold text-gray-700">                                                {item.description}                                                {item.service_code && <span className="block text-[10px] text-gray-400 font-mono mt-1">CODE-{item.service_code}</span>}                                            </td>                                            <td className="px-8 py-6 text-center font-black text-gray-500">{item.quantity}</td>                                            <td className="px-8 py-6 text-right font-black text-gray-600">Rs.{parseFloat(item.unit_price).toLocaleString()}</td>                                            <td className="px-8 py-6 text-right font-black text-gray-900">Rs.{(item.quantity * item.unit_price).toLocaleString()}</td>                                        </tr>                                    ))) : (                                        <tr className="hover:bg-gray-50/30 transition-colors">                                            <td className="px-8 py-6 font-bold text-gray-700">General Consultation / Clinical Service</td>                                            <td className="px-8 py-6 text-center font-black text-gray-500">1</td>                                            <td className="px-8 py-6 text-right font-black text-gray-600">Rs.{parseFloat(bill.total_amount).toLocaleString()}</td>                                            <td className="px-8 py-6 text-right font-black text-gray-900">Rs.{parseFloat(bill.total_amount).toLocaleString()}</td>                                        </tr>                                    )}                                </tbody>                            </table>                        </div>                    </div>                    <div className="flex justify-end pt-10">                        <div className="w-full max-w-sm space-y-6">                            <div className="flex justify-between items-center px-4">                                <span className="text-[11px] font-black text-gray-400 uppercase tracking-widest">Subtotal</span>                                <span className="font-bold text-gray-600">Rs.{parseFloat(bill.total_amount).toLocaleString()}</span>                            </div>                            <div className="flex justify-between items-center px-4">                                <span className="text-[11px] font-black text-gray-400 uppercase tracking-widest">Clinical Tax (0%)</span>                                <span className="font-bold text-gray-600">Rs.0.00</span>                            </div>                            <div className="h-px bg-gray-100"></div>                            <div className="flex justify-between items-center bg-gray-900 rounded-3xl p-8 text-white shadow-2xl shadow-gray-950/20 group hover:scale-[1.02] transition-transform">                                <span className="text-xs font-black uppercase tracking-[0.2em] opacity-60">Grand Total</span>                                <div className="text-right">                                    <span className="text-3xl font-black tracking-tighter block leading-none">Rs.{parseFloat(bill.total_amount).toLocaleString()}</span>                                    <p className="text-[10px] font-black text-emerald-400 mt-2 uppercase tracking-widest">Synchronized</p>                                </div>                            </div>                        </div>                    </div>                </div>                <div className="bg-gray-50 p-10 border-t border-gray-100">                    <p className="text-[11px] font-bold text-gray-400 uppercase tracking-[0.2em] text-center leading-relaxed">                        This is a computer-generated institutional record and does not require a physical signature. <br />                        All fiscal transactions are final and clinical-verified.                    </p>                </div>            </div>        </div>    );}