'use client';import { useState, useEffect } from 'react';import { useRouter, useParams } from 'next/navigation';import { useUser, hasRole } from '@/context/UserContext';import { useNavigation } from '@/context/NavigationContext';import { getUser, updateUser } from '@/lib/api';import { FaUserEdit, FaArrowLeft, FaSave, FaTimes } from 'react-icons/fa';import { toast } from 'react-toastify';export default function EditUserPage(props) {    const { id: propId } = props;    const params = useParams();    const { navigateTo } = useNavigation();    const id = propId || params?.id;    const { user, loading: authLoading } = useUser();    const [form, setForm] = useState({ name: '', email: '', phone: '', role_id: '' });    const [loading, setLoading] = useState(true);    const [saving, setSaving] = useState(false);    const [error, setError] = useState('');    useEffect(() => {        if (user && hasRole(user.role, ['admin'])) {            if (id) fetchUser();        }    }, [user, id]);    async function fetchUser() {        try {            const data = await getUser(id);            if (data.success && data.data) {                const fetchedUser = data.data;                setForm({                    name: fetchedUser.name,                    email: fetchedUser.email,                    phone: fetchedUser.phone || '',                    role_id: fetchedUser.role_id ? fetchedUser.role_id.toString() : ''                });            } else {                setError('User not found');            }        } catch (err) {            console.error(err);            setError('Failed to fetch user details');        } finally {            setLoading(false);        }    }    const handleChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });    async function handleSubmit(e) {        e.preventDefault();        setError('');        setSaving(true);        try {            const updatePayload = {                name: form.name,                email: form.email,                phone: form.phone            };            if (form.role_id) {                updatePayload.role_id = parseInt(form.role_id);            }            await updateUser(id, updatePayload);            toast.success('User updated successfully');            navigateTo('users');        } catch (err) {            setError('Failed to update: ' + (err.message || err));            toast.error('Update failed');        } finally {            setSaving(false);        }    }    if (!authLoading && (!user || !hasRole(user.role, ['admin']))) {        return <p className="p-10 text-center text-red-500">Access denied</p>;    }    if (loading) return <div className="p-10 text-center">Loading User Matrix...</div>;    return (        <div className="max-w-2xl mx-auto space-y-6 animate-in fade-in zoom-in duration-300">            <div className="flex items-center justify-between">                <div>                    <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">                        <FaUserEdit className="text-primary-600" /> Edit User                    </h1>                    <p className="text-gray-500 text-sm">Update staff account details</p>                </div>                <button                    onClick={() => navigateTo('users')}                    className="px-4 py-2 bg-blue-50 border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2 text-sm font-medium"                >                    <FaArrowLeft size={12} /> Back                </button>            </div>            <div className="bg-white p-8 rounded-xl shadow-sm border border-slate-200">                {error && (                    <div className="mb-6 p-4 bg-red-50 text-red-700 rounded-lg text-sm font-medium border border-red-100">                        {error}                    </div>                )}                <form onSubmit={handleSubmit} className="space-y-6">                    <div className="space-y-1">                        <label className="text-sm font-bold text-slate-700">Full Name</label>                        <input                            name="name"                            value={form.name}                            onChange={handleChange}                            className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-sm"                            required                        />                    </div>                    <div className="space-y-1">                        <label className="text-sm font-bold text-slate-700">Email Address</label>                        <input                            name="email"                            value={form.email}                            onChange={handleChange}                            className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-sm"                            required                        />                    </div>                    <div className="space-y-1">                        <label className="text-sm font-bold text-slate-700">Phone Number</label>                        <input                            name="phone"                            value={form.phone}                            onChange={handleChange}                            className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all text-sm"                        />                    </div>                    <div className="space-y-1">                        <label className="text-sm font-bold text-slate-700">Role</label>                        <div className="relative">                            <select                                name="role_id"                                value={form.role_id}                                onChange={handleChange}                                className="w-full px-4 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all appearance-none text-sm"                            >                                <option value="">-- No Change --</option>                                <option value="1">Admin</option>                                <option value="2">Doctor</option>                                <option value="3">Nurse</option>                                <option value="4">Receptionist</option>                                <option value="5">Accountant</option>                            </select>                        </div>                    </div>                    <div className="pt-4 flex gap-3">                        <button                            type="submit"                            disabled={saving}                            className="px-6 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 flex items-center gap-2"                        >                            <FaSave size={14} /> {saving ? 'Saving...' : 'Save Changes'}                        </button>                        <button                            type="button"                            onClick={() => navigateTo('users')}                            className="px-6 py-2.5 bg-gray-100 text-gray-600 font-bold rounded-lg hover:bg-gray-200 transition-all flex items-center gap-2"                        >                            <FaTimes size={14} /> Cancel                        </button>                    </div>                </form>            </div>        </div>    );}