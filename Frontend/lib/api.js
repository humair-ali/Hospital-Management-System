const API_BASE = 'http://127.0.0.1:5000/api';export async function apiCall(endpoint, method = 'GET', body = null) {  const headers = {    'Content-Type': 'application/json'  };  const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;  if (token) {    headers.Authorization = `Bearer ${token}`;  }  const options = {    method,    headers  };  if (body) {    options.body = JSON.stringify(body);  }  try {    const response = await fetch(`${API_BASE}${endpoint}`, options);    const data = await response.json();    if (!response.ok) {      throw new Error(data.error || `Request failed with status ${response.status}`);    }    return data;  } catch (error) {    console.error(`API call failed:`, error);    throw error;  }}export async function login(email, password) {  return apiCall('/auth/login', 'POST', { email, password });}export async function register(name, email, password, phone, role_id) {  return apiCall('/auth/register', 'POST', { name, email, password, phone, role_id });}export async function registerPatient(data) {  return apiCall('/auth/register-patient', 'POST', data);}export async function registerDoctor(data) {  return apiCall('/auth/register-doctor', 'POST', data);}export async function getPatients(filters = {}) {  const params = new URLSearchParams();  if (!filters.limit) filters.limit = 10;  if (!filters.page) filters.page = 1;  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/patients?${params.toString()}`);}export async function getPatient(id) {  return apiCall(`/patients/${id}`);}export async function createPatient(data) {  return apiCall('/patients', 'POST', data);}export async function updatePatient(id, data) {  return apiCall(`/patients/${id}`, 'PUT', data);}export async function deletePatient(id) {  return apiCall(`/patients/${id}`, 'DELETE');}export async function getDoctors(filters = {}) {  const params = new URLSearchParams();  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/doctors?${params.toString()}`);}export async function getDoctor(id) {  return apiCall(`/doctors/${id}`);}export async function createDoctor(data) {  return apiCall('/doctors', 'POST', data);}export async function updateDoctor(id, data) {  return apiCall(`/doctors/${id}`, 'PUT', data);}export async function upsertDoctorProfile(data) {  return apiCall('/doctors/profile', 'POST', data);}export async function getDoctorAvailability(doctor_id) {  return apiCall(`/doctors/${doctor_id}/availability`);}export async function createAvailabilitySlot(doctor_id, data) {  return apiCall(`/doctors/${doctor_id}/availability`, 'POST', data);}export async function getMyPatients() {  return apiCall('/doctors/my-patients');}export async function getAppointments(filters = {}) {  const params = new URLSearchParams();  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/appointments?${params.toString()}`);}export async function getAppointment(id) {  return apiCall(`/appointments/${id}`);}export async function createAppointment(data) {  return apiCall('/appointments', 'POST', data);}export async function updateAppointment(id, data) {  return apiCall(`/appointments/${id}`, 'PUT', data);}export async function cancelAppointment(id) {  return apiCall(`/appointments/${id}`, 'DELETE');}export async function updateAppointmentStatus(id, status) {  return apiCall(`/appointments/${id}`, 'PUT', { status });}export async function getDoctorDashboardData() {  try {    const appointmentsResponse = await getAppointments({ limit: 50 });    return {      success: true,      data: appointmentsResponse.data || []    };  } catch (err) {    return { success: false, error: err.message };  }}export async function getBills(filters = {}) {  const params = new URLSearchParams();  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/bills?${params.toString()}`);}export async function getBill(id) {  return apiCall(`/bills/${id}`);}export async function createBill(data) {  return apiCall('/bills', 'POST', data);}export async function recordPayment(bill_id, data) {  return apiCall(`/bills/${bill_id}/payments`, 'POST', data);}export async function getUsers(filters = {}) {  const params = new URLSearchParams();  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/users?${params.toString()}`);}export async function getUser(id) {  return apiCall(`/users/${id}`);}export async function createUser(data) {  return apiCall('/users', 'POST', data);}export async function updateUser(id, data) {  return apiCall(`/users/${id}`, 'PUT', data);}export async function updateProfile(data) {  return apiCall('/users/profile', 'PUT', data);}export async function getMedicalRecords(filters = {}) {  const params = new URLSearchParams();  Object.entries(filters).forEach(([key, value]) => {    if (value) params.append(key, value);  });  return apiCall(`/medical-records?${params.toString()}`);}export async function getMedicalRecord(id) {  return apiCall(`/medical-records/${id}`);}export async function createMedicalRecord(data) {  return apiCall('/medical-records', 'POST', data);}export async function updateMedicalRecord(id, data) {  return apiCall(`/medical-records/${id}`, 'PUT', data);}export async function deleteMedicalRecord(id) {  return apiCall(`/medical-records/${id}`, 'DELETE');}export async function getDailyReport(date) {  return apiCall(`/reports/daily?date=${date}`);}export async function getMonthlyReport(month) {  return apiCall(`/reports/monthly?month=${month}`);}export async function getAnnualReport(year) {  return apiCall(`/reports/annual?year=${year}`);}let adminStatsCache = null;let adminStatsTimestamp = 0;const CACHE_DURATION = 5 * 60 * 1000;export async function getAdminStats() {  const now = Date.now();  if (adminStatsCache && (now - adminStatsTimestamp < CACHE_DURATION)) {    return { success: true, data: adminStatsCache };  }  const today = new Date().toISOString().split('T')[0];  try {    const response = await getDailyReport(today);    if (response.success) {      adminStatsCache = {        patients: response.data.total_patients,        appointments: response.data.appointments_count,        revenue: response.data.revenue,        doctors: response.data.staff_on_duty,        activity: response.data.weekly_activity || [],        recent_activity: response.data.recent_activity || []      };      adminStatsTimestamp = now;      return {        success: true,        data: adminStatsCache      };    }    return response;  } catch (err) {    return { success: false, error: err.message };  }}export async function globalSearch(query) {  return apiCall(`/search?q=${encodeURIComponent(query)}`);}export async function uploadFile(file) {  const formData = new FormData();  formData.append('file', file);  const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;  const headers = {};  if (token) {    headers.Authorization = `Bearer ${token}`;  }  const response = await fetch(`${API_BASE}/upload`, {    method: 'POST',    headers,    body: formData  });  const data = await response.json();  if (!response.ok) throw new Error(data.error || 'Upload failed');  return data;}