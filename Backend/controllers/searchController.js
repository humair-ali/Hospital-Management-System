const { pool } = require('../config/db');async function globalSearch(req, res) {    try {        const { q } = req.query;        if (!q || q.length < 2) {            return res.json({ success: true, data: [] });        }        const { role } = req.user;        const searchTerm = `%${q}%`;        const resultsArray = await Promise.all([            (['admin', 'doctor', 'nurse', 'receptionist'].includes(role))                ? pool.query(                    `SELECT id, name, medical_record_number as subtext, 'patient' as type                     FROM patients                     WHERE name LIKE ? OR medical_record_number LIKE ?                     LIMIT 5`,                    [searchTerm, searchTerm]                ).then(res => res[0])                : Promise.resolve([]),            (!['patient', 'accountant'].includes(role))                ? pool.query(                    `SELECT u.id, u.name, r.name as subtext, 'staff' as type                     FROM users u                     JOIN roles r ON u.role_id = r.id                    WHERE (u.name LIKE ? OR u.email LIKE ?) AND r.name != 'patient'                    LIMIT 5`,                    [searchTerm, searchTerm]                ).then(res => res[0])                : Promise.resolve([])        ]);        const results = [...resultsArray[0], ...resultsArray[1]];        res.json({            success: true,            data: results        });    } catch (err) {        console.error('Global search error:', err);        res.status(500).json({ success: false, error: 'Server error during search' });    }}module.exports = { globalSearch };