const { pool } = require('../config/db');async function runPerformanceMigration() {    console.log('üöÄ SYSTEM OVERHAUL: Boosting Database Performance...');    const connection = await pool.getConnection();    try {        const performanceIndexes = [            { table: 'appointments', name: 'idx_appt_date_status', col: 'scheduled_at, status' },            { table: 'payments', name: 'idx_payments_history', col: 'paid_at, amount' },            { table: 'patients', name: 'idx_patients_growth', col: 'created_at' },            { table: 'bills', name: 'idx_bills_fiscal', col: 'issued_at, status, total_amount' },            { table: 'patients', name: 'idx_patients_search', col: 'name, medical_record_number' },            { table: 'users', name: 'idx_users_active', col: 'email, role_id' }        ];        for (const idx of performanceIndexes) {            const [rows] = await connection.query(                `SELECT COUNT(1) IndexIsThere FROM INFORMATION_SCHEMA.STATISTICS                  WHERE table_schema=DATABASE() AND table_name='${idx.table}' AND index_name='${idx.name}'`            );            if (rows[0].IndexIsThere === 0) {                console.log(`‚ö° Optimized Index: Adding ${idx.name}...`);                await connection.query(`CREATE INDEX ${idx.name} ON ${idx.table} (${idx.col})`);            }        }        try {            await connection.query('SET GLOBAL innodb_flush_log_at_trx_commit = 2');             console.log('‚úÖ DB Tuning: Fast Commit Enabled');        } catch (e) {            console.warn('‚ö†Ô∏è Could not set global innodb variable. Skipping tuning.');        }    } catch (err) {        console.error('‚ùå Performance Overhaul Failed:', err);    } finally {        connection.release();        console.log('üèÅ Performance Overhaul Complete.');        process.exit(0);    }}runPerformanceMigration();